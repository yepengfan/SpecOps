# Implementation Plan: UX/UI Enhancements

**Branch**: `016-ux-ui-enhancements` | **Date**: 2026-02-23 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/016-ux-ui-enhancements/spec.md`

## Summary

Add 9 UX/UI enhancements to the SpecOps application: toast notifications (sonner), button micro-interactions, auto-expand evaluation panel, regeneration confirmation dialog, mobile-responsive chat panel, collapsible sections (Radix Collapsible), dark mode toggle (next-themes), onboarding guidance, and a project overview dashboard page. Two new dependencies (`sonner`, `next-themes`), seven new files (six components and one page), and modifications to thirteen existing files. No schema changes or server-side modifications.

## Technical Context

**Language/Version**: TypeScript 5.x
**Primary Dependencies**: Next.js 16, React 19, Zustand 5, Dexie.js 4, shadcn/ui, Tailwind CSS 4
**New Dependencies**: `sonner` ^2.x (toast notifications — shadcn/ui default), `next-themes` ^0.4.x (dark mode — Next.js standard)
**Storage**: IndexedDB via Dexie.js (no schema changes)
**Testing**: Jest (unit tests) — 313 existing tests
**Target Platform**: Web (Chrome, Firefox, Safari, Edge — last 2 versions + mobile Safari, Chrome Android)
**Project Type**: Web application (Next.js App Router)
**Performance Goals**: No runtime performance impact — UI presentation changes only
**Constraints**: React 19 lint rules prohibit `setState` in `useEffect` and ref access during render — must use "derived state from props" pattern (see research.md §5)
**Scale/Scope**: 7 new files + 13 modified files = 20 files, ~+739/-137 lines

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Minimal Server, Secure API Proxy | PASS | All changes are client-side UI components. No server changes. No new API routes. |
| II. Phase Gate Discipline (NON-NEGOTIABLE) | PASS | Phase gate logic unchanged. Overview dashboard reads phase status but does not modify it. Collapsible sections and evaluation auto-expand are presentation-only. |
| III. Spec as Source of Truth | PASS | Spec content is unchanged. Only the presentation layer is enhanced. No silent modifications to spec content. |
| IV. EARS Format for Requirements | PASS | No changes to requirement format, parsing, or validation. |
| V. AI-Agent-Optimized Output | PASS | No changes to AI output format or export templates. Toast replaces inline error display only. |
| VI. Simplicity and YAGNI | PASS | Each enhancement is minimal and self-contained. Two small dependencies chosen as shadcn/ui and Next.js defaults respectively. No custom abstractions — using library primitives directly. |

**Post-design re-check**: All principles still pass. No new complexity introduced beyond the 9 targeted enhancements. No constitution violations to justify.

## Project Structure

### Documentation (this feature)

```text
specs/016-ux-ui-enhancements/
├── spec.md              # Feature specification
├── plan.md              # This file
├── research.md          # Technology decisions and rationale
├── data-model.md        # UI entity definitions (no schema changes)
├── quickstart.md        # Verification scenarios
├── checklists/
│   └── requirements.md  # Spec quality checklist
└── tasks.md             # Task breakdown (generated by /speckit.tasks)
```

### Source Code (repository root)

```text
components/
├── ui/
│   ├── sonner.tsx              # NEW — Sonner toaster wrapper with theme support
│   ├── button.tsx              # MODIFY — Add press-down scale animation
│   ├── collapsible.tsx         # NEW — Radix Collapsible primitive re-export
│   ├── alert-dialog.tsx        # NEW — Radix AlertDialog for regeneration confirmation
│   ├── theme-provider.tsx      # NEW — next-themes ThemeProvider wrapper
│   └── theme-toggle.tsx        # NEW — Sun/Moon theme toggle button
├── editor/
│   └── section-editor.tsx      # MODIFY — Add regeneration confirmation dialog
├── eval/
│   └── evaluation-panel.tsx    # MODIFY — Auto-expand via derived state, toast errors
├── chat/
│   └── chat-panel.tsx          # MODIFY — Mobile responsive layout + backdrop
├── phase/
│   ├── gated-phase-page.tsx    # MODIFY — Collapsible sections + Expand/Collapse All
│   ├── phase-nav.tsx           # MODIFY — Add Overview tab
│   └── workflow-indicator.tsx  # NEW — Three-phase visual stepper

app/
├── layout.tsx                  # MODIFY — Add Toaster, ThemeProvider, ThemeToggle
├── project/[id]/
│   ├── page.tsx                # MODIFY — Redirect to overview instead of active phase
│   ├── overview/page.tsx       # NEW — Project overview dashboard
│   ├── spec/page.tsx           # MODIFY — Toast errors, onboarding, generationKey
│   ├── plan/page.tsx           # MODIFY — Toast errors
│   ├── tasks/page.tsx          # MODIFY — Toast errors
│   └── traceability/page.tsx   # MODIFY — Toast errors

__tests__/
└── unit/
    └── phase-nav.test.tsx      # MODIFY — Update for Overview tab
```

**Structure Decision**: Follows existing Next.js App Router conventions. New UI primitives go in `components/ui/` (shadcn/ui pattern). New feature components go in `components/phase/`. New page follows App Router file-based routing at `app/project/[id]/overview/page.tsx`.

## Key Design Decisions

### 1. Toast Notifications (FR-001, FR-019, FR-020)

Replace inline `error` state + red banner JSX blocks with `toast.error(message)` from sonner across 4 phase pages and the evaluation panel. Keep informational inline warnings (amber "Spec must be reviewed" banners) as-is — they are persistent guidance, not transient errors (FR-019).

**Deep analysis toast** uses `toast.error(message, { action: { label: "Retry", onClick: handleDeepAnalysis } })` to provide retry affordance without an inline error div (FR-020).

**Dark mode integration**: The `<Sonner>` component receives the current theme from `useTheme()` so toasts render correctly in both themes.

**Files**: `components/ui/sonner.tsx` (new), `app/layout.tsx`, `app/project/[id]/spec/page.tsx`, `plan/page.tsx`, `tasks/page.tsx`, `traceability/page.tsx`, `components/eval/evaluation-panel.tsx`

### 2. Button Micro-Interactions (FR-002)

Add `active:scale-[0.97] transition-transform` to the button CVA base styles. This provides universal press feedback across all button variants with a single CSS change.

**Files**: `components/ui/button.tsx`

### 3. Evaluation Panel Auto-Expand (FR-003)

Uses React's "derived state from props" pattern to auto-expand when evaluation becomes available:

```
Track prevEvaluation in state.
On each render, if evaluation !== prevEvaluation:
  - Update prevEvaluation
  - If evaluation is truthy and panel is closed, set isOpen to true
```

This pattern avoids `useEffect` (prohibited by React 19 `react-hooks/set-state-in-effect` rule) and `useRef` (prohibited during render by `react-hooks/refs` rule). See research.md §5.

**Files**: `components/eval/evaluation-panel.tsx`

### 4. Regeneration Confirmation Dialog (FR-004, FR-005)

Add a Radix AlertDialog to `section-editor.tsx`. Only triggers when the section has non-empty `content`. When empty, regeneration starts immediately without confirmation (FR-005).

**Files**: `components/ui/alert-dialog.tsx` (new), `components/editor/section-editor.tsx`

### 5. Mobile-Responsive Chat Panel (FR-006, FR-007)

Replace fixed `w-96` with `w-full md:w-96`. Add a backdrop overlay (`fixed inset-0 z-40 bg-black/50 md:hidden`) that closes the panel on click. The backdrop only renders on viewports narrower than 768px.

**Files**: `components/chat/chat-panel.tsx`

### 6. Collapsible Sections (FR-008, FR-009, FR-010)

Wrap each `<SectionEditor>` in a Radix Collapsible primitive. Track open state as `Set<string> | null` where `null` means "all open" (the default). Uses a `generationKey` counter that increments after successful AI generation, resetting the collapsible state via derived state from props pattern (see research.md §6).

**Files**: `components/ui/collapsible.tsx` (new), `components/phase/gated-phase-page.tsx`

### 7. Dark Mode Toggle (FR-011, FR-012, FR-013)

Uses the `class` attribute strategy on `<html>` for Tailwind CSS compatibility. ThemeProvider wraps the application in `layout.tsx`. `suppressHydrationWarning` on `<html>` prevents SSR mismatch warnings. Theme persists in localStorage automatically via next-themes.

**Files**: `components/ui/theme-provider.tsx` (new), `components/ui/theme-toggle.tsx` (new), `app/layout.tsx`

### 8. Onboarding Guidance (FR-014, FR-015)

New `WorkflowIndicator` component shows three connected phase circles (Spec → Plan → Tasks) with active/completed/locked visual states. Displayed on the spec page only when all spec sections have no content. Guidance text appears below the Generate button.

**Files**: `components/phase/workflow-indicator.tsx` (new), `app/project/[id]/spec/page.tsx`

### 9. Project Overview Dashboard (FR-016, FR-017, FR-018)

New page at `app/project/[id]/overview/page.tsx`. Reads all data from the Zustand store — no new database queries. Phase cards show status badges, section counts, and evaluation results. Traceability coverage uses `parseRequirementIds()` for canonical requirement extraction.

**Important**: `useMemo` for traceability computation must be placed before any early `return null` to satisfy React's rules-of-hooks. The memo handles `null` project internally.

**Files**: `app/project/[id]/overview/page.tsx` (new), `components/phase/phase-nav.tsx`, `app/project/[id]/page.tsx`

## File Change Summary

| File | Change Type | Scope |
|------|-------------|-------|
| `components/ui/sonner.tsx` | New | Sonner toaster wrapper with next-themes integration |
| `components/ui/button.tsx` | Modify | Add `active:scale-[0.97] transition-transform` to CVA base |
| `components/ui/collapsible.tsx` | New | Re-export Radix Collapsible primitives (Root, Trigger, Content) |
| `components/ui/alert-dialog.tsx` | New | Radix AlertDialog for confirmation dialogs |
| `components/ui/theme-provider.tsx` | New | next-themes ThemeProvider wrapper |
| `components/ui/theme-toggle.tsx` | New | Sun/Moon icon toggle button |
| `components/editor/section-editor.tsx` | Modify | Add AlertDialog for regeneration confirmation |
| `components/eval/evaluation-panel.tsx` | Modify | Auto-expand via derived state, toast errors, toast retry |
| `components/chat/chat-panel.tsx` | Modify | Full-width on mobile + backdrop overlay |
| `components/phase/gated-phase-page.tsx` | Modify | Collapsible sections, Expand/Collapse All, generationKey reset |
| `components/phase/phase-nav.tsx` | Modify | Add Overview tab with LayoutDashboard icon |
| `components/phase/workflow-indicator.tsx` | New | Three-phase visual stepper component |
| `app/layout.tsx` | Modify | Add Toaster, ThemeProvider, ThemeToggle to layout |
| `app/project/[id]/page.tsx` | Modify | Redirect to overview instead of active phase |
| `app/project/[id]/overview/page.tsx` | New | Project overview dashboard |
| `app/project/[id]/spec/page.tsx` | Modify | Toast errors, onboarding guidance, generationKey |
| `app/project/[id]/plan/page.tsx` | Modify | Toast errors (remove inline error state + banner) |
| `app/project/[id]/tasks/page.tsx` | Modify | Toast errors (remove inline error state + banner) |
| `app/project/[id]/traceability/page.tsx` | Modify | Toast errors (remove inline error state + banner) |
| `__tests__/unit/phase-nav.test.tsx` | Modify | Update assertions for Overview tab |
